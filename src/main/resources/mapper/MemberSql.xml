<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="devster.semi.mapper.MemberMapper">
    <select id="listAcademyInfo" resultType="AcademyInfoDto">
        select *
        from academyinfo
    </select>

    <select id="emailChk" resultType="int" parameterType="String">
        select count(*)
        from member
        where m_email = #{m_email}
    </select>

    <select id="apichk" resultType="int" parameterType="String">
        select count(*)
        from member
        where m_email = #{m_email}
          and m_type = 1
    </select>

    <select id="nickNameChk" resultType="int" parameterType="String">
        select count(*)
        from member
        where m_nickname = #{m_nickname}
    </select>

    <select id="emailpasschk" resultType="int" parameterType="Map">
        select count(*)
        from member
        where m_email = #{m_email}
          and m_pass = #{m_pass}
          and m_type = 0
    </select>

    <select id="cmEmailPassChk" resultType="int" parameterType="Map">
        select count(*)
        from companymember
        where cm_email = #{cm_email}
          and cm_pass = #{cm_pass}
    </select>

    <select id="getOneData" resultType="MemberDto" parameterType="String">
        select *
        from member
        where m_email = #{m_email}
    </select>
    <select id="getCmOneData" resultType="CompanyMemberDto" parameterType="String">
        select *
        from companymember
        where cm_email = #{cm_email}
    </select>
    <update id="dailyPoint" parameterType="String">
        update member
        set m_point=m_point + 10
        where m_email = #{m_email}
    </update>

    <select id="searchAcaInfo" resultType="AcademyInfoDto" parameterType="String">
        select *
        from academyinfo
        where ai_name like '%' || #{ai_name} || '%'
    </select>

    <select id="getAcademyIdx" resultType="int" parameterType="String">
        select ai_idx
        from academyinfo
        where ai_name = #{ai_name}
    </select>

    <insert id="addNewMember" parameterType="MemberDto">
        insert into member (m_email, m_pass, m_tele, ai_idx, m_name, m_nickname, m_photo, ai_name, salt, m_type)
        values (#{m_email}, #{m_pass}, #{m_tele}, #{ai_idx}, #{m_name}, #{m_nickname}, #{m_photo}, #{ai_name}, #{salt},
                #{m_type})
    </insert>

    <select id="getSaltById" resultType="String" parameterType="String">
        select salt
        from member
        where m_email = #{m_email}
    </select>

    <select id="CmGetSaltById" resultType="String" parameterType="String">
        select salt
        from companymember
        where cm_email = #{cm_email}
    </select>

    <select id="cmEmailChk" resultType="int" parameterType="String">
        select count(*)
        from companymember
        where cm_email = #{cm_email}
    </select>

    <select id="compNameChk" resultType="int" parameterType="String">
        select count(*)
        from companymember
        where cm_compname = #{cm_compname}
    </select>

    <insert id="addNewCMemeber" parameterType="CompanyMemberDto">
        insert into companymember (cm_email, cm_pass, cm_compname, cm_post, cm_addr, cm_tele, cm_name, cm_filename, cm_cp, salt)
        values (#{cm_email}, #{cm_pass}, #{cm_compname}, #{cm_post}, #{cm_addr}, #{cm_tele}, #{cm_name},#{cm_filename}, #{cm_cp},
                #{salt})
    </insert>
    <select id="getOneDataByM_idx" parameterType="int" resultType="MemberDto">
        select * from member where m_idx=#{m_idx}
    </select>

    <select id="getAcaNameByAi_idx" parameterType="int" resultType="String">
        SELECT a.ai_name
        FROM member m
                 JOIN academyinfo a
                      ON m.ai_idx = a.ai_idx;
    </select>
</mapper>